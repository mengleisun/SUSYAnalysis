//double etaRates[]={0.0491495,0.0316066,0.0253055,0.024221,0.0223884,0.0222271,0.0210704,0.0203349,0.0207721,0.0198487,0.0193914,0.0194545,0.0181131,0.0244214,0.0241276,0.0219053,0.0204027,0.0195225,0.0198563,0.0191962,0.0173755,0.0181452,0.0299651,0.0222873,0.0188254,0.0185798,0.0200921,0.0235761,0.0296801};   //nominal value

//double etaRates[]={0.220502,0.140268,0.10809,0.103675,0.097537,0.0952774,0.0908136,0.0850506,0.0866651,0.0835787,0.0757995,0.0753234,0.068137,0.0889137,0.084842,0.0757298,0.0660832,0.0620414,0.0606887,0.0575167,0.0498608,0.049543,0.0793691,0.0565387,0.0459593,0.0437259,0.0464076,0.0531607,0.0645416};  // with 0.02 FSR


double etaRatesEB[]={0.0492472,0.0317083,0.0249878,0.0237811,0.0225391,0.0217952,0.021218,0.0204555,0.0209017,0.0213058,0.0195457,0.0195127,0.0182495,0.0245207,0.0241966,0.0217942,0.0204352,0.0195351,0.0197452,0.0191388,0.0175107,0.0181074,0.0299934,0.0222525,0.0188657,0.0184809,0.0201496,0.0238605,0.0297451,0.0377252,0.0377252,0.0227009,0.0244784,0.0228702,0.0253518,0.0235908,0.0233666,0.0235654,0.0239859,0.0196564,0.015901,0.0143372,0.0146783,0.0142111,0.013783,0.0138453,0.0156311,0.0386086,0.137861,0.137861,0.137861};
double etaRatesEE[]={0.0307332,0.0299524,0.0280145,0.02547,0.0240278,0.021802,0.0225558,0.0226875,0.0226886,0.0215866,0.0236088,0.020717,0.0216991,0.0226854,0.0261154,0.0234785,0.0237738,0.0238696,0.0231526,0.0241064,0.0236423,0.0225728,0.0225309,0.0215295,0.0229856,0.0243029,0.0229342,0.0232938,0.0247321,0.023548,0.022498,0.0218185,0.0234682,0.0254467,0.0246834,0.0229259,0.0231025,0.0216125,0.0210904,0.0221214,0.0202627,0.0191955,0.0160481,0.0167744,0.0160238,0.0159168,0.014636,0.0140576,0.0140319,0.0145108,0.0134792,0.0133057,0.0126636,0.0134775,0.013568,0.0148307,0.0137881,0.0142709,0.0140171,0.0141443,0.0132946,0.0153951,0.0128556,0.0131305,0.0117914,0.0133917,0.0128375,0.0132793,0.0119076,0.0128915,0.0121654,0.0120543,0.0132253,0.0130123,0.0126019,0.0131891,0.0144337,0.0154444,0.0201884,0.023823,0.0273998,0.0323177,0.0384226,0.0467818,0.0621622,0.077865,0.101108,0.12769,0.155996,0.190138,0.234992,0.292042,0.303861,0.183474};

Double_t fakerate_func(Double_t *x, Double_t *par)
{
	double weight_pt(0.02);
	double weight_nvtx(0.02);
	double weight_eta(0.02);

	double normfactor = par[0];
  double slope = par[1];
  double constant = par[2];
  double index = par[3];
  double coeff = 1.0; 
	double vtx_constant = par[5];
	double vtx_slope = par[6];

  double pt = TMath::Max(x[0],0.000001);
	double nvtx=x[1];
	double eta= x[2];

	//if(pt >200)pt= 200.0;

	double arg = 0;
	arg = slope*pt + constant; 
	double fitval = pow(arg, index)*coeff; 
	weight_pt = fitval;

	weight_nvtx = vtx_constant + vtx_slope*nvtx;

	if(eta >= 0 && eta < 1.4442){
		for(int ieta(0); ieta < 29; ieta++)
			if(eta > ieta*0.05 && eta <= (ieta+1)*0.05)weight_eta = etaRatesEB[ieta];
	}
	else if(eta > 1.56 && eta <= 2.5){
		for(int ieta(0); ieta < 94; ieta++)
			if(eta > 1.56 + ieta*0.01 && eta <= 1.56+(ieta+1)*0.01)weight_eta = etaRatesEE[ieta];
	}
	else weight_eta = 0;

	double totalfakerate= normfactor*weight_pt*weight_nvtx*weight_eta;
	//return totalfakerate/(1-totalfakerate);
	return totalfakerate;

//1275 1565
}

Double_t jetfake_func(Double_t *x, Double_t *par)
{
	double pt_low = x[0] - 1.0/2.0;
	double pt_high = x[0]+ 1.0/2.0;

	double c1 = par[0];
	double c2 = par[1];
	double lamda1 = par[2];
	double lamda2 = par[3];

	double jetfakes_lowedge = c1*exp(lamda1*pt_low)/lamda1 + c2*exp(lamda2*pt_low)/lamda2;
	double jetfakes_highedge =  c1*exp(lamda1*pt_high)/lamda1 + c2*exp(lamda2*pt_high)/lamda2;
	//return (jetfakes_highedge + jetfakes_lowedge)/2.0*REBINSIZE;
	return (jetfakes_highedge - jetfakes_lowedge);
}


//eta 0    0.0492472
//eta 0.05 0.0317083
//eta 0.1  0.0249878
//eta 0.15 0.0237811
//eta 0.2  0.0225391
//eta 0.25 0.0217952
//eta 0.3  0.021218
//eta 0.35 0.0204555
//eta 0.4  0.0209017
//eta 0.45 0.0213058
//eta 0.5  0.0195457
//eta 0.55 0.0195127
//eta 0.6  0.0182495
//eta 0.65 0.0245207
//eta 0.7  0.0241966
//eta 0.75 0.0217942
//eta 0.8  0.0204352
//eta 0.85 0.0195351
//eta 0.9  0.0197452
//eta 0.95 0.0191388
//eta 1    0.0175107
//eta 1.05 0.0181074
//eta 1.1  0.0299934
//eta 1.15 0.0222525
//eta 1.2  0.0188657
//eta 1.25 0.0184809
//eta 1.3  0.0201496
//eta 1.35 0.0238605
//eta 1.4  0.0297451
//eta 1.45 0.0377252
//eta 1.5  0.0377252

//eta 1.56 0.0307332
//eta 1.57 0.0299524
//eta 1.58 0.0280145
//eta 1.59 0.02547
//eta 1.6  0.0240278
//eta 1.61 0.021802
//eta 1.62 0.0225558
//eta 1.63 0.0226875
//eta 1.64 0.0226886
//eta 1.65 0.0215866
//eta 1.66 0.0236088
//eta 1.67 0.020717
//eta 1.68 0.0216991
//eta 1.69 0.0226854
//eta 1.7  0.0261154
//eta 1.71 0.0234785
//eta 1.72 0.0237738
//eta 1.73 0.0238696
//eta 1.74 0.0231526
//eta 1.75 0.0241064
//eta 1.76 0.0236423
//eta 1.77 0.0225728
//eta 1.78 0.0225309
//eta 1.79 0.0215295
//eta 1.8  0.0229856
//eta 1.81 0.0243029
//eta 1.82 0.0229342
//eta 1.83 0.0232938
//eta 1.84 0.0247321
//eta 1.85 0.023548
//eta 1.86 0.022498
//eta 1.87 0.0218185
//eta 1.88 0.0234682
//eta 1.89 0.0254467
//eta 1.9  0.0246834
//eta 1.91 0.0229259
//eta 1.92 0.0231025
//eta 1.93 0.0216125
//eta 1.94 0.0210904
//eta 1.95 0.0221214
//eta 1.96 0.0202627
//eta 1.97 0.0191955
//eta 1.98 0.0160481
//eta 1.99 0.0167744
//eta 2    0.0160238
//eta 2.01 0.0159168
//eta 2.02 0.014636
//eta 2.03 0.0140576
//eta 2.04 0.0140319
//eta 2.05 0.0145108
//eta 2.06 0.0134792
//eta 2.07 0.0133057
//eta 2.08 0.0126636
//eta 2.09 0.0134775
//eta 2.1  0.013568
//eta 2.11 0.0148307
//eta 2.12 0.0137881
//eta 2.13 0.0142709
//eta 2.14 0.0140171
//eta 2.15 0.0141443
//eta 2.16 0.0132946
//eta 2.17 0.0153951
//eta 2.18 0.0128556
//eta 2.19 0.0131305
//eta 2.2  0.0117914
//eta 2.21 0.0133917
//eta 2.22 0.0128375
//eta 2.23 0.0132793
//eta 2.24 0.0119076
//eta 2.25 0.0128915
//eta 2.26 0.0121654
//eta 2.27 0.0120543
//eta 2.28 0.0132253
//eta 2.29 0.0130123
//eta 2.3  0.0126019
//eta 2.31 0.0131891
//eta 2.32 0.0144337
//eta 2.33 0.0154444
//eta 2.34 0.0201884
//eta 2.35 0.023823
//eta 2.36 0.0273998
//eta 2.37 0.0323177
//eta 2.38 0.0384226
//eta 2.39 0.0467818
//eta 2.4  0.0621622
//eta 2.41 0.077865
//eta 2.42 0.101108
//eta 2.43 0.12769
//eta 2.44 0.155996
//eta 2.45 0.190138
//eta 2.46 0.234992
//eta 2.47 0.292042
//eta 2.48 0.303861
//eta 2.49 0.183474
